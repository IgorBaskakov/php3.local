<?xml version="1.0" encoding="UTF-8" ?>

<project name="PHP-3" basedir="." default="symlink">

    <target name="vars">

        <echo msg="Settings local vars..." />

        <resolvepath propertyName="tmp.dir" file="${project.basedir}" />
        <echo msg="Tmp dir is: ${tmp.dir}" />

        <php returnProperty="build.time" function="date">
            <param value="Y-m-d-H-i-s" />
        </php>

        <resolvepath propertyName="target.dir" file="c:\OSPanel\domains\src\php3.server\${build.time}" />
        <echo msg="Target dir is: ${target.dir}" />
    </target>

    <target name="copy" depends="vars">
        <mkdir dir="${target.dir}" />
        <copy todir="${target.dir}">
            <fileset dir="${tmp.dir}">
                <include name="**" />
                <exclude name="vendor/**" />
                <exclude name=".idea/**" />
            </fileset>
        </copy>
    </target>

    <target name="composer" depends="copy">
        <exec dir="${target.dir}" command="composer install" checkreturn="true" passthru="true"/>
    </target>

    <target name="symlink" depends="copy, composer">
        <symlink link="c:\OSPanel\domains\php3.server" target="c:\OSPanel\domains\src\php3.server\${build.time}" overwrite="true" />
    </target>

</project>